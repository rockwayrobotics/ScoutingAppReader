<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Rockway Robotics Scouting App</title>
        <meta name="description" content="A scouting app built for Rockway Robotics - Team 8089">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
        <link rel="manifest" href="manifest.json">
        <script src="html5-qrcode.min.js"></script>
        <meta name="theme-color" content="#A71F28"/>
        <link rel="apple-touch-icon" href="icons/apple-icon-180.png">
    </head>
    <body>
        <div class="form">
            <h1>Rockway Robotics</h1>
            <noscript><h4>You aren't using javascript which is really cool but also that breaks this whole site so please enable javascript</h4></noscript>
              <div style="width: 600px" id="reader"></div>
              <h3>QR CODE DATA:</h3>
              <table id="qrTable"></table>
            <script type="module">
              var scannedQRCodes = [];

              function onScanSuccess(decodedText, decodedResult) {
    // Parse the decodedText as JSON
    var decodedJson;
    try {
      decodedJson = JSON.parse(decodedText);
    } catch (e) {
      console.error("Invalid JSON format: ", decodedText);
      return;
    }

    // Handle on success condition with the decoded text or result.
    if (!scannedQRCodes.some(qrCode => JSON.stringify(qrCode) === JSON.stringify(decodedJson))) {
      // If it's not in the array, add it to the array
      scannedQRCodes.push(decodedJson);

      // Create a new row in the HTML table with the JSON data
      var table = document.getElementById('qrTable');
      var row = table.insertRow();
      Object.values(decodedJson).forEach(text => {
        var cell = row.insertCell();
        cell.textContent = text;
      });
    }

    console.log(`Scan result: ${decodedText}`, decodedResult);
  }

              var html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", { fps: 10, qrbox: 250 });

            html5QrcodeScanner.render(onScanSuccess);
          </script>
          </div>
          <script>
              if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js');
              }
          </script>
    </body>
</html>